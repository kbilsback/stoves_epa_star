---
title: "Lab grav"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r global_options, include=FALSE}
  knitr::opts_chunk$set(fig.path='figures/', warning=FALSE, message=FALSE, cache=FALSE)
```

```{r load_libraries}
  library(tidyverse)
  library(forcats)
  library(gridExtra)
```

```{r load_functions}
  source("../r_scripts/plots.R")
```

# Load data

* gravimetric

```{r load_data}
  grav <- readRDS("../r_files/lab_grav.RDS")
```

# Organize

* select only rocket elbow and artisan clay stoves

```{r filter_stoves}
  grav <- dplyr::select(grav, id, pm_ef, mce, fp, pm_flag) %>%
          dplyr::filter(grepl("^1[A-Z]|^3[A-Z]|^15[A-Z]|^16[A-Z]|^19[A-Z]|^20[A-Z]|^21[A-Z]", id))
```

* add stove fuel information 

```{r add_test_info}
  grav <- dplyr::mutate(grav, stove = ifelse(grepl("^1[A-Z]|^3[A-Z]", id), "Three stone fire", "")) %>%
          dplyr::mutate(stove = ifelse(grepl("^15[A-Z]|^16[A-Z]", id), "Clay ring", stove)) %>%
          dplyr::mutate(stove = ifelse(grepl("^19[A-Z]|^20[A-Z]|^21[A-Z]", id), "Rocket elbow", stove)) %>%
          dplyr::mutate(stove = as.factor(stove)) %>%
          dplyr::mutate(fuel = ifelse(grepl("^1[A-Z]|^15[A-Z]|^19[A-Z]|^21[A-Z]", id), "Douglas fir", "Eucalyptus")) %>%
          dplyr::mutate(fuel = as.factor(fuel))
```

# Firepower vs. PM EF

* three stone fire (linear model)

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  m_grav <- dplyr::filter(grav, stove == "Three stone fire") %>%
            dplyr::mutate(fp_2 = fp*fp)
  model <- lm(pm_ef ~ fp, data = m_grav)
  c <- coefficients(model)
  summary(model)

```

* three stone fire (quadratic model)

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  model <- lm(pm_ef ~ fp + fp_2, data = m_grav)
  c <- coefficients(model)
  summary(model)

```

```{r, fig.width=12, fig.height=10, echo=FALSE}
 p1 <- ggplot(m_grav, aes(x = fp, y = pm_ef)) +
    geom_point() +
    geom_smooth(method = "lm") +
    theme_bw() +
    xlab("firepower (kW)") + 
    ylab("pm ef (g/kg fuel)") + 
    theme(axis.text.x = element_text(size = 20)) +
    theme(axis.text.y = element_text(size = 20),
          axis.title=element_text(size=20))

 p2 <- ggplot(m_grav, aes(x = fp, y = pm_ef, colour = fuel)) +
    geom_point() +
    geom_smooth(method = "lm") +
    theme_bw() +
    xlab("firepower (kW)") + 
    ylab("pm ef (g/kg fuel)") + 
    theme(axis.text.x = element_text(size = 20)) +
    theme(axis.text.y = element_text(size = 20),
          axis.title=element_text(size=20))
 
   grid.arrange(p1, p2, ncol = 2)
```

* clay ring (linear model)

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  m_grav <- dplyr::filter(grav, stove == "Clay ring") %>%
            dplyr::mutate(fp_2 = fp*fp)
  model <- lm(pm_ef ~ fp, data = m_grav)
  c <- coefficients(model)
  summary(model)

```

* clay ring (quadratic model)

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  model <- lm(pm_ef ~ fp + fp_2, data = m_grav)
  c <- coefficients(model)
  summary(model)

```

```{r, fig.width=12, fig.height=10, echo=FALSE}
 p1 <- ggplot(m_grav, aes(x = fp, y = pm_ef)) +
    geom_point() +
    geom_smooth(method = "lm") +
    theme_bw() +
    xlab("firepower (kW)") + 
    ylab("pm ef (g/kg fuel)") + 
    theme(axis.text.x = element_text(size = 20)) +
    theme(axis.text.y = element_text(size = 20),
          axis.title=element_text(size=20))

 p2 <- ggplot(m_grav, aes(x = fp, y = pm_ef, colour = fuel)) +
    geom_point() +
    geom_smooth(method = "lm") +
    theme_bw() +
    xlab("firepower (kW)") + 
    ylab("pm ef (g/kg fuel)") + 
    theme(axis.text.x = element_text(size = 20)) +
    theme(axis.text.y = element_text(size = 20),
          axis.title=element_text(size=20))
 
   grid.arrange(p1, p2, ncol = 2)
```

* rocket elbow (linear model)

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  m_grav <- dplyr::filter(grav, stove == "Rocket elbow") %>%
            dplyr::mutate(fp_2 = fp*fp)
  model <- lm(pm_ef ~ fp, data = m_grav)
  c <- coefficients(model)
  summary(model)

```

* rocket elbow (quadratic model)

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  model <- lm(pm_ef ~ fp + fp_2, data = m_grav)
  c <- coefficients(model)
  summary(model)

```

```{r, fig.width=12, fig.height=10, echo=FALSE}
 p1 <- ggplot(m_grav, aes(x = fp, y = pm_ef)) +
    geom_point() +
    geom_smooth(method = "lm") +
    theme_bw() +
    xlab("firepower (kW)") + 
    ylab("pm ef (g/kg fuel)") + 
    theme(axis.text.x = element_text(size = 20)) +
    theme(axis.text.y = element_text(size = 20),
          axis.title=element_text(size=20))

 p2 <- ggplot(m_grav, aes(x = fp, y = pm_ef, colour = fuel)) +
    geom_point() +
    geom_smooth(method = "lm") +
    theme_bw() +
    xlab("firepower (kW)") + 
    ylab("pm ef (g/kg fuel)") + 
    theme(axis.text.x = element_text(size = 20)) +
    theme(axis.text.y = element_text(size = 20),
          axis.title=element_text(size=20))
 
   grid.arrange(p1, p2, ncol = 2)
```

# MCE vs. PM EF

```{r plot_pm_mce, fig.width=12, fig.height=10, echo=FALSE}
  ggplot(grav, aes(x = mce, y = pm_ef, colour = stove)) +
    geom_point() +
    facet_wrap(stove~fuel, scales = "free") +
    geom_smooth(method = "lm") +
    xlab("mce") + 
    ylab("pm ef (g/kg fuel)") + 
    theme(axis.text.x = element_text(size = 20)) +
    theme(axis.text.y = element_text(size = 20),
          axis.title=element_text(size=20))
    