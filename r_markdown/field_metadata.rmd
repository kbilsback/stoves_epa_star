---
title: "Field metadata qaqc"
output:
  html_document:
    toc: true
    toc_float: true
---

```{r library, warning=FALSE, message=FALSE, echo=FALSE}
  library(tidyverse)
  library(gridExtra)
  library(knitr)
```

```{r global_options, include=FALSE}
  knitr::opts_chunk$set(fig.path='figures/', warning=FALSE, message=FALSE, cache=FALSE)
```

# Load files

* Load metadata

```{r load_data}
  field_meta <- readRDS("../r_files/field_meta.RDS")
  field_data <- readRDS("../r_files/rose_field_data2.RDS")
```

* Load functions

```{r functions}
  source("../r_scripts/functions.R")
  source("../r_scripts/plots.R")
```

# Clean metadata

## Test times

```{r tidy_times}
  field_test_times <- dplyr::select(field_meta, field_site, hh_id, date,
                                    pre_bkgd_start, pre_bkgd_end, sample_start,
                                    sample_end, post_bkgd_start, post_bkgd_end) %>%
                      dplyr::mutate(hh_id = as.factor(hh_id), 
                                    dur = sample_end - sample_start) %>%
                      dplyr::group_by(field_site, hh_id, date) %>%
                      tidyr::gather("var", "value", 4:ncol(.)) %>%
                      dplyr::mutate(var = as.factor(var)) %>%
                      tibble::as_data_frame()
```

## Test metadata

```{r tidy_samples}
 # sample info
  field_samples <- dplyr::select(field_data, country, id, stove, fuel, test_length)
```

## Fuel weight

```{r fuel_wgt}
  fuel_wgts <- dplyr::mutate(field_meta, fuel_wgt = fuel_pre_weigh - fuel_post_weigh) %>%
              dplyr::select(field_site, hh_id, fuel_wgt) %>%
              dplyr::mutate(units = "kilograms")
```

# Save metadata

```{r save_data}
  saveRDS(field_test_times, file = "../r_files/field_test_times.RDS")
  saveRDS(field_samples, file = "../r_files/field_samples.RDS")
  saveRDS(fuel_wgts, file = "../r_files/field_fuel_wgts.RDS")
```