---
title: "Notes"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  library(tidyverse)
  library(forcats)
```

# Load files

```{r load_files}
  notes <- readRDS("../r_files/field_notes.rds")
  flows <- readRDS("../r_files/field_inst_flows.rds")
  filter_meta <- readRDS("../r_files/field_filter_meta.rds")
  grav <- readRDS("../r_files/field_grav.rds")
```

# Compile overall test notes

```{r compile_notes}
  notes_1 <- dplyr::select(flows, hh_id, inst, notes) %>%
             dplyr::filter(!is.na(notes))
```

# Compile inst notes

```{r grav_notes}
  notes_g1 <- dplyr::select(filter_meta, hh_id, notes) %>%
              dplyr::filter(!is.na(notes)) %>%
              dplyr::filter(!is.na(hh_id)) %>%
              dplyr::mutate(inst = "grav:ecoc")

  notes_g2 <- dplyr::select(grav, hh_id, notes) %>%
              dplyr::filter(!is.na(notes)) %>%
              dplyr::filter(!is.na(hh_id)) %>%
              dplyr::mutate(inst = "grav")
```

# Combine all notes

```{r compile_notes}
  inst_notes <- dplyr::bind_rows(notes_1, notes_g1, notes_g2)
```

# Create qc flag

With default value `maybe`.

```{r add_flag}
  inst_notes <- dplyr::mutate(inst_notes, qc = factor("maybe", c("bad", "maybe", "ok")))
```

# Combine with overall notes

```{r combine_notes}
  notes <- dplyr::bind_rows(notes, inst_notes) %>%
           dplyr::mutate(hh_id = as.factor(hh_id))
```

# Adjust some flags based on notes

```{r adjust_flags}
```

# Save notes

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  saveRDS(notes, file = "../r_files/field_compiled_notes.rds")
```
