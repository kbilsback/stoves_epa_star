---
title: "Figure 5 for Firepower Sweep Paper"
output:
  html_document:
    toc: true
    toc_float: true
    theme: paper
---

```{r load_libraries, echo=FALSE, message=FALSE}
  library(tidyverse)
```

```{r global_options, include=FALSE}
  knitr::opts_chunk$set(fig.path='figures/', warning=FALSE, message=FALSE, cache=FALSE, echo=FALSE)
```

```{r load_data}
  fst <- readRDS("../r_files/lab_grav_merged.RDS")
  wbt <- readRDS("../r_files/wbt_data_merged.RDS")
  field <- readRDS("../r_files/field_data_merged.RDS")
  rose <- readRDS("../r_files/rose_data_merged.RDS")
```

```{r}
  field_plot_1 <-
    fst %>%
    dplyr::filter(id != "3B", fuel != "okote") %>%
    dplyr::filter(grepl("co_ef|pm_ef|bc_ef", var),
                  grepl("*|three stone fire|ceramic jiko|forced|rocket elbow", stove)) %>%
    tidyr::spread(var, val) %>%
    dplyr::select(stove, fuel, co_ef, pm_ef, bc_ef, test_type)
```

```{r}
  field_plot_2 <-
    field %>%
    dplyr::filter(grepl("co|pm|ec", pol),
                  grepl("mean", var),
                  grepl("*|rocket elbow|three stone fire|draft", stove)) %>%
    tidyr::spread(pol, value) %>%
    dplyr::rename("co_ef" = "co", "pm_ef" = "pm", "bc_ef" = "ec") %>%
    dplyr::select(stove, fuel, co_ef, pm_ef, bc_ef, test_type)
```

```{r}
  field_plot_3 <-
    rose %>%
    dplyr::select(stove, fuel, co_ef, pm_ef, bc_ef, test_type)

  field_plot_4 <-
    wbt %>%
    dplyr::filter(grepl("pm|pm2.5", pol), grepl("grams per kilogram", units),
                  var == "mean", fuel_notes == "dry") %>%
    dplyr::select(id, stove, fuel, pol, var, value, protocol, protocol_notes, test_type) %>%
    tidyr::spread(var, value) %>%
    dplyr::rename("pm_ef" = "mean") %>%
    dplyr::left_join(wbt %>%
                     dplyr::filter(grepl("co", pol), grepl("grams per kilogram", units),
                     var == "mean", fuel_notes == "dry") %>%
                     dplyr::select(id, stove, fuel, pol, var, value, protocol, protocol_notes,
                                   test_type) %>%
                     tidyr::spread(var, value) %>%
                     dplyr::rename("co_ef" = "mean"),
                     by = c("id", "protocol", "stove", "fuel", "protocol_notes", "test_type")) %>%
    dplyr::filter(grepl("three|metal jiko|rocket|forced|plancha*|ceramic jiko", stove)) %>%
    dplyr::mutate(protocol = "WBT") %>%
    dplyr::select(stove, fuel, co_ef, pm_ef, test_type)


  field_plot <-
    dplyr::bind_rows(field_plot_1, field_plot_2) %>%
    dplyr::bind_rows(field_plot_3) %>%
    dplyr::bind_rows(field_plot_4)
```

```{r,fig.width=8, fig.height=4}
  field_plot %>%
  dplyr::filter(!grepl("metal|imp.", stove)) %>%
  ggplot(aes(y = pm_ef, x = test_type)) +
    geom_jitter(aes(color = fuel), width = 0.15, shape = 4, stroke = 1) +
    geom_boxplot(alpha = 0) +
    theme_bw() + 
    scale_y_log10() +
    theme(text = element_text(size = 14),
          axis.text.x = element_text(angle = 25, hjust = 1, vjust = 1, size = 10),
          strip.text.x = element_text(size = 9),
          legend.position = "top") +
    facet_grid(~stove, space = "free", scale = "free") +
    scale_colour_manual(values = c("#F0E442", "#999999", "#CC79A7", "#E69F00",
                                   "#009E73", "#56B4E9", "#D55E00")) +
    xlab("") +
    ylab("Particulate Matter (g/kg)") +
    labs(color = "")
```

```{r, fig.width=8, fig.height=3}
  field_plot %>%
  #dplyr::filter(!grepl("", stove)) %>%
  ggplot(aes(y = co_ef, x = test_type)) +
    geom_jitter(aes(color = fuel), width = 0.15, shape = 4, stroke = 1) +
    geom_boxplot(alpha = 0) +
    theme_bw() + 
    scale_y_log10() +
    theme(text = element_text(size = 14),
          axis.text.x = element_text(angle = 25, hjust = 1, vjust = 1, size = 10),
          strip.text.x = element_text(size = 9),
          legend.position = "none") +
    facet_grid(~stove, space = "free", scale = "free") +
    scale_colour_manual(values = c("#F0E442", "#999999", "#CC79A7", "#E69F00",
                                   "#009E73", "#56B4E9", "#D55E00")) +
    xlab("") +
    ylab("Carbon Monoxide (g/kg)")
```

```{r}
  field_plot %>%
  dplyr::filter(!grepl("metal|imp.", stove)) %>%
  ggplot(aes(y = bc_ef, x = test_type)) +
    geom_jitter(aes(color = fuel), width = 0.15, shape = 4, stroke = 1) +
    geom_boxplot(alpha = 0) +
    theme_bw() + 
    scale_y_log10() +
    theme(text = element_text(size = 14),
          axis.text.x = element_text(angle = 25, hjust = 1, vjust = 1, size = 10),
          legend.text = element_text(size = 10),
          legend.position = "top") +
    facet_grid(~stove, space = "free", scale = "free") +
    scale_colour_manual(values = c("#0072B2", "#999999", "#CC79A7", "#E69F00",
                                   "#009E73", "#56B4E9", "#D55E00")) +
    xlab("") +
    ylab("Black Carbon (g/kg)")
```