---
title: "Firepower exploratory analysis"
output:
  html_document:
    toc: true
    toc_float: true
    theme: paper
---

```{r load_libraries, echo=FALSE, message=FALSE}
  library(tidyverse)
```

```{r global_options, include=FALSE}
  knitr::opts_chunk$set(fig.path='figures/', warning=FALSE, message=FALSE, cache=FALSE, echo=FALSE)
```

```{r load_data}
  grav <- readRDS("../r_files/lab_grav_merged.RDS")
  jetter_data <- readRDS("../r_files/jetter_data.RDS")
```

```{r load_functions}
  #source("../r_scripts/plots.R")
  #source("../r_scripts/functions.R")
```

```{r}
  grav <-
    grav %>%
    dplyr::filter(id != "3B")
```

# By stove type

```{r, echo=FALSE}
  ggplot(data = grav %>%
           dplyr::filter(grepl("fp", var)), aes(x = stove, y = val)) +
    geom_boxplot(outlier.colour = NA) +
    geom_jitter(aes(color = fuel)) +
    geom_point(data = jetter_data %>%
               dplyr::filter(grepl("firepower", pol)) %>%
               dplyr::mutate(value = value / 1000) %>%
               tidyr::spread(var, value) %>%
               dplyr::filter(grepl("three|gasifier|justa|charcoal [:(:]|rocket", stove),
                             fuel_notes == "dry"),
               aes(x = stove, y = mean, shape = protocol), size = 3) +
      scale_shape(solid = FALSE) +
      theme_bw() +
      theme(text = element_text(size = 16),
            axis.text.x = element_text(angle = 15, hjust = 1, vjust = 1),
            legend.position = "top") +
      facet_grid(~stove_cat, scales = "free_x", space = "free_x") +
      ylab("Firepower (kW)") +
      xlab("")
```

```{r, echo=FALSE, fig.height=6, fig.width=14}
  # geom_point(jetter_data %>%
  #   dplyr::filter(grepl("firepower", pol)) %>%
  #   dplyr::mutate(value = value / 1000) %>%
  #   tidyr::spread(var, value) %>%
  #   aes_string(x = "stove", y = "mean")) + 
  #     #geom_errorbar(ymin = (mean - stdev), ymax = (mean + stdev)) +
  #     theme_bw() +
  #     theme(text = element_text(size = 16),
  #           axis.text.x = element_text(angle = 15, hjust = 1, vjust = 1),
  #           legend.position = "top") +
  #     ylab("Firepower (kW)") +
  #     xlab("")
```

```{r, echo=FALSE}
  ggplot(grav %>%
          dplyr::filter(grepl("mce", var)),
          aes_string(x = "stove", y = "val")) +
      geom_boxplot(outlier.colour = NA) +
      geom_jitter(aes(color = fuel)) +
      geom_point(data = jetter_data %>%
               dplyr::filter(grepl("mce", pol)) %>%
               tidyr::spread(var, value) %>%
               dplyr::filter(grepl("three|gasifier|justa|charcoal [:(:]|rocket", stove),
                             fuel_notes == "dry"),
               aes(x = stove, y = mean, shape = protocol), size = 3) +
      scale_shape(solid = FALSE) +
      guides(fill = FALSE) +
      theme_bw() +
      theme(text = element_text(size = 16),
            axis.text.x = element_text(angle = 15, hjust = 1, vjust = 1),
            legend.position = "top") +
      facet_grid(~stove_cat, scales = "free_x", space = "free_x") +
      ylab("Modified combustion efficiency") +
      xlab("")
```

```{r, echo=FALSE, fig.height=6, fig.width=14}
  grav %>%
    dplyr::filter(grepl("pm_ef", var)) %>%
    ggplot(aes_string(x = "stove", y = "val")) +
      geom_boxplot(outlier.colour = NA) +
      geom_jitter(aes(color = fuel)) +
      scale_shape(solid = FALSE) +
      guides(fill = FALSE) +
      theme_bw() +
      theme(text = element_text(size = 16),
            axis.text.x = element_text(angle = 15, hjust = 1, vjust = 1),
            legend.position = "top") +
      facet_wrap(stove_cat~fuel_type, scales = "free_x", nrow = 1) +
      ylab("PM EF") +
      xlab("")
```

```{r, echo=FALSE, fig.height=6, fig.width=14}
  grav %>%
    dplyr::filter(grepl("bc_ef", var)) %>%
    ggplot(aes_string(x = "stove", y = "val")) +
      geom_boxplot(outlier.colour = NA) +
      geom_jitter(aes(color = fuel)) +
      scale_shape(solid = FALSE) +
      guides(fill = FALSE) +
      theme_bw() +
      theme(text = element_text(size = 16),
            axis.text.x = element_text(angle = 15, hjust = 1, vjust = 1),
            legend.position = "top") +
      facet_wrap(stove_cat~fuel_type, scales = "free_x", nrow = 1) +
      ylab("BC EF") +
      xlab("")
```

```{r, eval=FALSE}
  res.aov <- 
    grav %>%
    dplyr::filter(grepl("mce", var)) %>%
    tidyr::spread("var", "val") %>%
    aov(mce ~ stove, data = .)

  summary(res.aov)
  TukeyHSD(res.aov)
```

```{r, echo=FALSE, fig.height=6, fig.width=14}
  grav %>%
    dplyr::filter(grepl("fp", var)) %>%
    ggplot(aes_string(x = "stove", y = "val")) +
      geom_point(aes(color = fuel)) +
      scale_shape(solid = FALSE) +
      guides(fill = FALSE) +
      theme_bw() +
      theme(text = element_text(size = 16),
            axis.text.x = element_text(angle = 15, hjust = 1, vjust = 1),
            legend.position = "top") +
      facet_wrap(stove_cat~fuel_type, scales = "free_x", nrow = 1) +
      ylab("Firepower (kW)") +
      xlab("")
```

# By fuel type

```{r, echo=FALSE, fig.height=6, fig.width=14}
  grav %>%
    dplyr::filter(grepl("fp", var)) %>%
    ggplot(aes_string(x = "fuel", y = "val")) +
      geom_boxplot(outlier.colour = NA) +
      geom_jitter(aes(color = stove)) +
      scale_shape(solid = FALSE) +
      guides(fill = FALSE) +
      theme_bw() +
      theme(text = element_text(size = 16),
            axis.text.x = element_text(angle = 15, hjust = 1, vjust = 1),
            legend.position = "top") +
      facet_wrap(stove_cat~fuel_type, scales = "free_x", nrow = 1) +
      ylab("Firepower (kW)") +
      xlab("")
```

```{r, eval=FALSE}
  res.aov <- 
    grav %>%
    dplyr::filter(grepl("fp", var)) %>%
    tidyr::spread("var", "val") %>%
    aov(fp ~ fuel, data = .)

  summary(res.aov)
  TukeyHSD(res.aov)
```

```{r, echo=FALSE, fig.height=6, fig.width=14}
  grav %>%
    dplyr::filter(grepl("mce", var)) %>%
    ggplot(aes_string(x = "fuel", y = "val")) +
      geom_boxplot(outlier.colour = NA) +
      geom_jitter(aes(color = stove)) +
      scale_shape(solid = FALSE) +
      guides(fill = FALSE) +
      theme_bw() +
      theme(text = element_text(size = 16),
            axis.text.x = element_text(angle = 15, hjust = 1, vjust = 1),
            legend.position = "top") +
      facet_wrap(stove_cat~fuel_type, scales = "free_x", nrow = 1) +
      ylab("Modified combustion efficiency") +
      xlab("")
```

```{r, eval=FALSE}
  res.aov <- 
    grav %>%
    dplyr::filter(grepl("mce", var)) %>%
    tidyr::spread("var", "val") %>%
    aov(mce ~ fuel, data = .)

  summary(res.aov)
  TukeyHSD(res.aov)
```