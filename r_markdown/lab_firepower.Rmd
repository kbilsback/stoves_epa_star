---
title: "Firepower exploratory analysis"
output:
  html_document:
    toc: true
    toc_float: true
    theme: paper
---

```{r load_libraries, echo=FALSE, message=FALSE}
  library(tidyverse)
```

```{r global_options, include=FALSE}
  knitr::opts_chunk$set(fig.path='figures/', warning=FALSE, message=FALSE, cache=FALSE, echo=FALSE)
```

```{r load_data}
  grav <- readRDS("../r_files/lab_grav_merged.RDS")
  jetter_data <- readRDS("../r_files/jetter_data.RDS")
```

```{r}
  grav <-
    grav %>%
    dplyr::filter(id != "3B", fuel != "okote")
```

# Firepower by Stove Type

```{r fig_1_a, echo=FALSE, fig.height=6, fig.width=10}
  jetter_plot <-
    jetter_data %>%
    dplyr::filter(grepl("firepower", pol)) %>%
    dplyr::mutate(value = value / 1000) %>%
    tidyr::spread(var, value) %>%
    dplyr::mutate(y_min = mean - stdev, y_max = mean + stdev) %>%
    dplyr::filter(grepl("three|gasifier|justa|charcoal [:(:]|rocket", stove),
                  fuel_notes == "dry")

  ggplot(data = grav %>%
           dplyr::filter(grepl("fp", var)), aes(x = stove, y = val)) +
  geom_jitter(aes(color = fuel), width = 0.15, shape = 1, stroke = 1) +
  geom_boxplot(outlier.colour = NA, alpha = 0) +
  geom_point(data = jetter_plot, aes(x = stove, y = mean, shape = protocol, group = protocol),
             position = position_dodge(width = 0.3), size = 2.5) +
  geom_errorbar(data = jetter_plot, aes(x = stove, y = mean,
                                        ymin = y_min, ymax = y_max), width = 0.15,
                position = position_dodge(width = 0.3), stroke = 2) +
  theme_bw() +
  theme(text = element_text(size = 16),
        axis.text.x = element_text(angle = 25, hjust = 1, vjust = 1),
        legend.position = "top") +
  facet_wrap(~fuel_type, scales = "free") +
  ylab("Firepower (kW)") +
  xlab("")
```

# MCE by Stove Type

```{r fig_1_b, echo=FALSE, fig.height=6, fig.width=10}
  jetter_plot <-
    jetter_data %>%
    dplyr::filter(grepl("mce", pol)) %>%
    tidyr::spread(var, value) %>%
    dplyr::mutate(y_min = mean - stdev, y_max = mean + stdev) %>%
    dplyr::filter(grepl("three|gasifier|justa|charcoal [:(:]|rocket", stove),
                  fuel_notes == "dry")

  ggplot(data = grav %>%
           dplyr::filter(grepl("mce", var)), aes(x = stove, y = val)) +
  geom_jitter(aes(color = fuel), width = 0.15, shape = 1, stroke = 1) +
  geom_boxplot(outlier.colour = NA, alpha = 0) +
  geom_point(data = jetter_plot, aes(x = stove, y = mean, shape = protocol), size = 2.5) +
  geom_errorbar(data = jetter_plot, aes(x = stove, y = mean,
                                        ymin = y_min, ymax = y_max), width = 0.15, stroke = 2) +
  theme_bw() +
  theme(text = element_text(size = 16),
        axis.text.x = element_text(angle = 25, hjust = 1, vjust = 1),
        legend.position = "top") +
  facet_wrap(~fuel_type, scales = "free") +
  ylab("Combustion Efficiency") +
  xlab("")
```

```{r fig_2_a, echo=FALSE, fig.height=6, fig.width=10}
  jetter_plot <-
    jetter_data %>%
    dplyr::filter(grepl("pm2.5", pol), units == "grams per kilogram") %>%
    tidyr::spread(var, value) %>%
    dplyr::mutate(y_min = mean - stdev, y_max = mean + stdev) %>%
    dplyr::filter(grepl("three|gasifier|justa|charcoal [:(:]|rocket", stove),
                  fuel_notes == "dry")

  ggplot(data = grav %>%
           dplyr::filter(grepl("pm_ef", var)), aes(x = stove, y = val)) +
  geom_jitter(aes(color = fuel), width = 0.15, shape = 1, stroke = 1) +
  geom_boxplot(outlier.colour = NA, alpha = 0) +
  geom_point(data = jetter_plot, aes(x = stove, y = mean, shape = protocol), size = 2.5) +
  geom_errorbar(data = jetter_plot, aes(x = stove, y = mean,
                                        ymin = y_min, ymax = y_max), width = 0.15, stroke = 2) +
  theme_bw() +
  theme(text = element_text(size = 16),
        axis.text.x = element_text(angle = 25, hjust = 1, vjust = 1),
        legend.position = "top") +
  facet_wrap(~fuel_type, scales = "free") +
  ylab("Particulate Matter (grams per kilogram of fuel)") +
  xlab("")
```