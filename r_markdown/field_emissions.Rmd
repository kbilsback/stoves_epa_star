---
title: "Field emissions factors"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r load_libraries, include=FALSE}
  library(tidyverse)
  library(knitr)
```

```{r global_options, include=FALSE}
  knitr::opts_chunk$set(fig.path ='figures/', warning = FALSE, message = FALSE, cache = FALSE, tidy = TRUE)
```

# Load files

* functions 

```{r functions}
  source("../r_scripts/functions.R")
  source("../r_scripts/plots.R")
```

* pollutant data

```{r load_data}
  temp <- readRDS("../r_files/field_temp_merged.RDS")
  grav <- readRDS("../r_files/field_grav_merged.RDS")
  aqe <- readRDS("../r_files/field_aqe_merged.RDS")
  aqe_bkgd <- readRDS("../r_files/field_aqe_bkgd.RDS")
```

* constants

```{r load_constants}
  fuel_properties <- readRDS("../r_files/fuel_properties.RDS")
  pol_properties <- readRDS("../r_files/pol_properties.RDS")
```

# Gas analyzer

```{r aqe_test_avg}
  aqe <- aqe %>%
         dplyr::group_by(hh_id, var) %>%
         dplyr::summarise(avg = mean(val, na.rm = TRUE),
                          units = first(units),
                          qc = first(qc)) %>%
        dplyr::ungroup()
```

* convert mixing ratios to mass conc (assuming constant T and P)

```{r calc_mass_conc}
  aqe <- aqe %>%
         dplyr::left_join(aqe, pol_properties, by = "pol") %>%
         dplyr::mutate(conc = convert_ppmv_ugm3(ppmv = val, mw = mw))
```

