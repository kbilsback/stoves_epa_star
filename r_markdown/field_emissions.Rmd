---
title: "Field emissions factors"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r load_libraries, include=FALSE}
  library(tidyverse)
  library(knitr)
```

```{r global_options, include=FALSE}
  knitr::opts_chunk$set(fig.path ='figures/', warning = FALSE, message = FALSE, cache = FALSE, tidy = TRUE)
```

# Load files

* functions 

```{r functions}
  source("../r_scripts/functions.R")
  source("../r_scripts/plots.R")
```

* pollutant data

```{r load_data}
  temp <- readRDS("../r_files/field_temp_merged.RDS")
  grav <- readRDS("../r_files/field_grav_merged.RDS")
  aqe <- readRDS("../r_files/field_aqe_merged.RDS")
```

* constants

```{r load_constants}
  fuel_properties <- readRDS("../r_files/fuel_properties.RDS")
```

# Gravimetric particulate matter

* calculate concentrations

```{r grav_calculations}
  grav <- dplyr::mutate(grav, conc = (mass * 1000 / (flow * dur)),
                        )
```

* calculate mass emitted

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  carbonyls <- dplyr::mutate(carbonyls, 
                             mass_emitted = (conc - conc_bg) * hood_flow * dur,
                             mass_carbon = mass_emitted * (num_c * mw_c / mw),
                             inst = "carbs")
```

* output

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  head(carbonyls, 2)
```
